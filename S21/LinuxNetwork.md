## Part 1. Инструмент ipcalc

1) Адрес сети 192.167.38.54/13
    - ```192.160.0.0```


2) Перевод маски 255.255.255.0 в префиксную и двоичную запись, /15 в обычную и двоичную, 11111111.11111111.11111111.11110000 в обычную и префиксную
    - ```255.255.255.0 в префиксной: /24 ```
    - ```255.255.255.0 в двоичной: 11111111.11111111.11111111.00000000```
    - ```/15 в обычной: 255.254.0.0```
    - ```/15 в двоичной: 11111111.11111110.00000000.00000000```
    - ```11111111.11111111.11111111.11110000 в обычной: 255.255.255.240```
    - ```11111111.11111111.11111111.11110000 в префиксной: /28 ```

3) Минимальный и максимальный хост в сети 12.167.38.4 при масках: /8, 11111111.11111111.00000000.00000000, 255.255.254.0 и /4

    - ```На скрине минимальные и максимальные хосты по заданным маскам ```
    <br>![alt text](./images/5.1.png)
    ![alt text](./images/5.2.png)
    ![alt text](./images/5.3.png)
    ![alt text](./images/5.4.png)

### 1.2. localhost

- 194.34.23.100 - нет
- 127.0.0.2 - да
- 127.1.0.1 - да
- 128.0.0.1 - нет

### 1.3. Диапазоны и сегменты сетей

1. какие из перечисленных IP можно использовать в качестве публичного, а какие только в качестве частных:
    - 10.0.0.45 - частный
    - 134.43.0.2 - публичный
    - 192.168.4.2 - частный
    - 172.20.250.4 - частный
    - 172.0.2.1 - публичный
    - 192.172.0.1 - публичный
    - 172.68.0.2 - публичный
    - 172.16.255.255 - частный
    - 10.10.10.10 - частный
    - 192.169.168.1 - публичный


2. какие из перечисленных IP адресов шлюза возможны у сети 10.10.0.0/18:
    - 10.0.0.1 - не возможен
    - 10.10.0.2 - возможен
    - 10.10.10.10 - возможен
    - 10.10.100.1 - не возможен
    - 10.10.1.255 - возможен

## Part 2. Статическая маршрутизация между двумя машинами

- ```ip a (ws1, ws2)```
<br>![alt text](./images/6.png)![alt text](./images/7.png)


- ```Опиши сетевой интерфейс, соответствующий внутренней сети, на обеих машинах и заданы следующие адреса и маски: ws1 - 192.168.100.10, маска /16, ws2 - 172.24.116.8, маска /12```
  <br>![alt text](./images/8.png)![alt text](./images/9.png)


- ```netplan apply```
<br>![alt text](./images/10.png)![alt text](./images/11.png)


### 2.1. Добавление статического маршрута вручную


- ```Команды для добаления статического маршрута, пинг```
  <br>![alt text](./images/12.png)![alt text](./images/13.png)


### 2.2. Добавление статического маршрута с сохранением

- ```Изменённые файлы etc/netplan/00-installer-config.yaml```
  <br>![alt text](./images/16.png)![alt text](./images/17.png)

- ```Пропинговали ещё раз```
  <br>![alt text](./images/14.png)![alt text](./images/15.png)

## Part 3. Утилита iperf3

### 3.1. Скорость соединения

- 8 Mbps = 1 MB/s
- 100 MB/s = 819200 Kbps
- 1 Gbps = 1024 Mbps

### 3.2. Утилита iperf3

- ```Скорость соединения между ws1 и ws2```
  <br>![alt text](./images/22.png)![alt text](./images/23.png)

## Part 4. Сетевой экран

### 4.1. Утилита iptables

- ```Правила в /etc/firewall.sh```
  <br>![alt text](./images/24.png)![alt text](./images/25.png)

- ```Запуска файлов на обеих машинах```
  <br>![alt text](./images/26.png)![alt text](./images/27.png)
- Правило которое было добавлено последним имеет приоритет.
### 4.2. Утилита nmap

- ```Ping + nmap```
  <br>![alt text](./images/28.png)![alt text](./images/29.png)

## Part 5. Статическая маршрутизация сети

### Cкрины с содержанием файла etc/netplan/00-installer-config.yaml для каждой машины:
- ```WS11```
<br>![alt text](./images/32.png)

- ```R1```
<br>![alt text](./images/30.png)

- ```WS21```
<br>![alt text](./images/34.png)

- ```WS22```
<br>![alt text](./images/33.png)

- ```R2```
<br>![alt text](./images/31.png)

### Если ошибок нет, то командой ip -4 a проверить, что адрес машины задан верно.

- ```WS11```
<br>![alt text](./images/37.png)

- ```R1```
<br>![alt text](./images/35.png)

- ```WS21```
<br>![alt text](./images/39.png)

- ```WS22```
<br>![alt text](./images/38.png)

- ```R2```
<br>![alt text](./images/36.png)

### Пропинговать ws22 с ws21. Аналогично пропинговать r1 с ws11.

- ```WS22 c WS21```
<br>![alt text](./images/40.png)

- ```R1 c WS11```
<br>![alt text](./images/41.png)

### 5.2. Включение переадресации IP-адресов.
- ```sysctl -w net.ipv4.ip_forward=1 на роутерах```
<br>![alt text](./images/42.png)![alt text](./images/43.png)

- ```net.ipv4.ip_forward=1 в /etc/sysctl.conf на роутерах```
<br>![alt text](./images/44.png)![alt text](./images/45.png)

### 5.3. Установка маршрута по-умолчанию

Скрины etc/netplan/00-installer-config.yaml:
- ```WS11 netplan```
<br>![alt text](./images/46.png)

- ```WS21 netplan```
<br>![alt text](./images/47.png)

- ```WS22 netplan```
<br>![alt text](./images/48.png)

- ```Скрин выполнения команды ip r```
<br>![alt text](./images/49.png)![alt text](./images/50.png)![alt text](./images/51.png)

- ```Пропинговали r2 с ws11```
<br>![alt text](./images/52.png)![alt text](./images/53.png)

### 5.4. Добавление статических маршрутов

- ```netplan роутеров:```
<br>![alt text](./images/54.png)![alt text](./images/55.png)

- ```Маршруты роутеров: (ip r)```
<br>![alt text](./images/56.png)![alt text](./images/57.png)

- ```ip r list 10.10.0.0/[маска сети] и ip r list 0.0.0.0/0```
<br>![alt text](./images/58.png)

- Для адреса 10.10.0.0/18 был выбран маршрут, отличный от 0.0.0.0/0, потому что при наличии нескольких маршрутов одинаковой длины выбирается тот маршрут, который задан наиболее точно.

### 5.5. Построение списка маршрутизаторов

- ```Вывод команд traceroute и tcpdump```
<br>![alt text](./images/59.png)![alt text](./images/60.png)

Утилита Traceroute вместо ICMP-запроса отправляет 3 UDP-пакета на определенный порт целевого хоста и ожидает ответа о недоступности этого порта. Первый пакет отправляется с TTL=1, второй с TTL=2 и так далее, пока запрос не попадёт адресату. Так как вместо ICMP-запроса он отправляет UDP-запрос, в каждом запросе есть порт отправителя и порт получателя. По умолчанию запрос отправляется на закрытый порт 34434. Когда запрос попадёт на хост назначения, этот хост отправит ответ о недоступности порта «Destination port unreachable» (порт назначения недоступен). Это значит, что адресат получил запрос. Traceroute воспримет этот ответ как завершение трассировки.

### 5.6. Использование протокола ICMP при маршрутизации

- ```Пинг несуществующего ip, дамп с r1```
<br>![alt text](./images/61.png)![alt text](./images/62.png)

## Part 6. Динамическая настройка IP с помощью DHCP

- ```1) указать адрес маршрутизатора по-умолчанию, DNS-сервер и адрес внутренней сети. Пример файла для r2:```
<br>![alt text](./images/63.png)

- ```2) в файле resolv.conf прописать nameserver 8.8.8.8.```
<br>![alt text](./images/64.png)

- ```Рестарт isc-dhcp-server```
<br>![alt text](./images/65.png)

- ```После перезагрузки посмотрели, что адрес получили```
<br>![alt text](./images/66.png)

- ```Пропинговали ws22 с ws21```
<br>![alt text](./images/67.png)

- ```Измненный netplan ws11```
<br>![alt text](./images/68.png)

- ```Настройка dhcpd.conf для r1```
<br>![alt text](./images/69.png)

- ```Рестарт isc-dhcp-server для r1```
<br>![alt text](./images/90.png)
- ```WS11 ip a после перезагрузки получили ip```
<br>![alt text](./images/70.png)


- ```ip WS21 до обновления```
<br>![alt text](./images/71.png)
- ```ip WS21 после обновления```
<br>![alt text](./images/72.png)

## Part 7. NAT

- ```В файле /etc/apache2/ports.conf на ws22 и r1 изменили строку Listen 80 на Listen 0.0.0.0:80, то есть сделали сервер Apache2 общедоступным```
<br>![alt text](./images/73.png)![alt text](./images/74.png)

- ```Запуск серверов Apache2```
<br>![alt text](./images/75.png)![alt text](./images/76.png)

- ```Пинг с ws22 до r1 не удаётся```
<br>![alt text](./images/77.png)

- ```Успешно пропинговались с ws22 до r1 после разрешения маршрутизации icmp на r2```
<br>![alt text](./images/78.png)

- ```Изменённый firewall.sh на r2```
<br>![alt text](./images/79.png)

- ```Подключились с ws22 к серверу Apache на r1```
<br>![alt text](./images/80.png)

- ```Подключились с r1 к серверу Apache на ws22```
<br>![alt text](./images/81.png)

## Part 8. Дополнительно. Знакомство с SSH Tunnels

- ```Запустить на r2 фаервол с правилами из Части 7```
<br>![alt text](./images/82.png)

- ```Запустить веб-сервер Apache на ws22 только на localhost (то есть в файле /etc/apache2/ports.conf изменить строку Listen 80 на Listen localhost:80)```
<br>![alt text](./images/83.png)

- ```Воспользоваться Local TCP forwarding с ws21 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws21```
<br>![alt text](./images/85.png)

- ```Воспользоваться Remote TCP forwarding c ws11 до ws22, чтобы получить доступ к веб-серверу на ws22 с ws11 (прописываем именно с ws22)```
<br>![alt text](./images/86.png)


- ```Подключились к серверу с ws21 до ws22```
<br>![alt text](./images/87.png)

- ```Подключились к серверу с ws11 до ws22```
<br>![alt text](./images/88.png)